app.controller('HomePageCtrl', ['$scope', '$http', '$location', '$auth', '$routeParams', function($scope, $http, $location, $auth, $routeParams){

  var url = "<%= ENV['URL'] %>" || "http://localhost:3000";


// ============= POSITION ============== //

  // SHOW ALL POSITIONS
  $scope.positions = [];
  $http.get(url + '/positions').success(function(response){
    $scope.positions = response
    console.log($scope.positions)
  });

  // CREATE NEW POSITION
  $scope.newPosition = {};
  $scope.positionForm = {};
  $scope.positionForm.create = function(){
    var data = {
      position: $scope.newPosition
    };

    $http.post(url + '/positions', data).success(function(response){
      console.log(response);
    });

    $http.get(url + '/positions').success(function(response){
      $scope.positions = response
      console.log($scope.positions)
    });
  };

  // DELETE A POSITION
  $scope.delete = function(position){
    var pos_to_delete = $scope.positions.indexOf(position);
    $http.delete(url + '/positions/' + position.id).success(function(response){
      $scope.positions.splice(pos_to_delete, 1);
      console.log(response);
    });
  console.log(position.id);
  };

// =========== TECHNIQUE TYPE ============ //

  // SHOW TECHNIQUE TYPES & TECHNIQUES
  $scope.technique_types = []
  $scope.currentPosition = []
  $scope.currentPostionName = []
  $scope.getPosition = function(position){
    console.log(position.id)
    $scope.currentPosition = position.id
    $scope.currentPositionName = position.name

    $http.get(url + '/positions/' + position.id + '/technique_types').success(function(response){
      $scope.technique_types = response;
      console.log(response);
      console.log($scope.techniques);
    });
  };

  // CREATE NEW TECHNIQUE TYPE
  $scope.newTechType = {};
  $scope.techTypeForm = {};
  $scope.techTypeForm.create = function(){
    var data = {
      technique_type: $scope.newTechType
    };

    $http.post(url + '/positions/' + $scope.currentPosition + '/technique_types', data).success(function(response){
      console.log(response);
    });

    $http.get(url + '/positions/' + $scope.currentPosition + '/technique_types').success(function(response){
      $scope.technique_types = response
    });
  };

  // DELETE TECHNIQUE TYPE
  $scope.deleteTechType = function(technique_type){
    var ttype_to_delete = $scope.technique_types.indexOf(technique_type);
    $http.delete(url + '/positions/' + $scope.currentPosition + '/technique_types/' +technique_type.id).success(function(response){
      $scope.technique_types.splice(ttype_to_delete, 1);
      console.log(response);
    });
  console.log(technique_type.id);
  };

// =============== TECHNIQUE =============== //

  // CREATE NEW TECHNIQUE
  $scope.newTech = {};
  $scope.techForm = {};
  $scope.techForm.create = function(technique_type){
    var data = {
      technique: $scope.newTech
    };
    $http.post(url + '/positions/' + $scope.currentPosition + '/technique_types/' +technique_type.id + '/techniques', data).success(function(response){
      console.log(response);
    });

    $http.get(url + '/positions/' + $scope.currentPosition + '/technique_types').success(function(response){
      $scope.technique_types = response;
    });
  };

  // DELETE TECHNIQUE
  $scope.deleteTech = function(technique_type,technique){
    var tech_type_to_delete = $scope.technique_types.indexOf(technique_type);
    var tech_to_delete = $scope.technique_types[tech_type_to_delete].techniques.indexOf(technique);

    $http.delete(url + '/positions/' + $scope.currentPosition + '/technique_types/' +technique_type.id + '/techniques/' + technique.id).success(function(response){
        $scope.technique_types[tech_type_to_delete].techniques.splice(tech_to_delete, 1);
    });
  };

// =========== TECHNIQUE-COLUMN =========== //

  // SHOW NAME, VIDEO URL, NOTES, STEPS 

$scope.currentTechnique = []
$scope.steps = [];
  $scope.getTechnique = function(technique_type, technique){
    console.log(technique.id)
    var tech_type_to_get = $scope.technique_types.indexOf(technique_type);
    var tech_to_get = $scope.technique_types[tech_type_to_get].techniques.indexOf(technique);

    // GET VIDEO URL, NOTES
    $http.get(url + '/positions/' + $scope.currentPosition + '/technique_types/' +technique_type.id + '/techniques/' + technique.id).success(function(response){
      $scope.technique = response;
      $scope.currentTechnique = $scope.technique
      console.log($scope.currentTechnique)

      //Notes fill
      $scope.newNotes = $scope.currentTechnique.other_notes 
      if ($scope.currentTechnique.other_notes == null) {
        $scope.doNotesExist = false;
      } else {
        $scope.doNotesExist = true;
      }
    });

    // GET STEPS
    $http.get(url + '/positions/' + $scope.currentPosition + '/technique_types/' +technique_type.id + '/techniques/' + technique.id + '/steps').success(function(response) {
        console.log(response)
        $scope.steps = response
    })
  };


  $scope.editBtn = function() {
    $scope.doNotesExist = false;
    console.log("edit")
  }


  // EDIT NOTES

  $scope.newNotes = {};
  $scope.notesForm = {};

  $scope.notesForm.create = function(){
    var data = {
      other_notes: $scope.newNotes
    };
    $http.put(url + '/positions/' + $scope.currentPosition + '/technique_types/' + $scope.currentTechnique.technique_type_id + '/techniques/' + $scope.currentTechnique.id, data).success(function(response){
      console.log(response)
      $scope.doNotesExist = true;
    })
  }


  // CREATE STEPS
  $scope.newStep = {};
  $scope.stepForm = {};
  $scope.stepForm.create = function(){
    var data = {
      instruction: $scope.newStep
    };
    $http.post(url + '/positions/' + $scope.currentPosition + '/technique_types/' + $scope.currentTechnique.technique_type_id + '/techniques/' + $scope.currentTechnique.id + '/steps', data).success(function(response){
      console.log(response);
    });

    $http.get(url + '/positions/' + $scope.currentPosition + '/technique_types/' + $scope.currentTechnique.technique_type_id + '/techniques/' + $scope.currentTechnique.id + '/steps').success(function(response) {
        console.log(response)
        $scope.steps = response
    })
  };

    // DELETE TECHNIQUE
  $scope.deleteStep = function(step){
    var step_to_delete = $scope.steps.indexOf(step);
    $http.delete(url + '/positions/' + $scope.currentPosition + '/technique_types/' + $scope.currentTechnique.technique_type_id + '/techniques/' + $scope.currentTechnique.id + '/steps/' + step.id).success(function(response){
        $scope.steps.splice(step_to_delete, 1);
        console.log(response);
    });
  };





}]);

